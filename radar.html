<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF‚Äë8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>StormBuddy Radar</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { font-family: 'Outfit', sans-serif; margin:0; background:#f4f9fe; color:#102a43; }
    .navbar { height:70px; background:#fff; display:flex; align-items:center; padding:0 20px; border-bottom:1px solid #e1e7ef; }
    .navbar .logo { font-size:1.5rem; font-weight:700; color:#0072ff; }
    .nav-links { margin-left:auto; }
    .nav-links a { text-decoration:none; color:#102a43; font-weight:500; cursor:pointer; }
    .nav-links a:hover { color:#0072ff; }
    #inputForm { margin:20px 0; display:flex; gap:8px; justify-content:center; }
    #locationInput { padding:8px; font-size:1rem; width:200px; border-radius:6px; border:1px solid #ccc; }
    #submitBtn { padding:8px 16px; background:#0072ff; color:#fff; border:none; border-radius:6px; font-weight:600; cursor:pointer; }
    #submitBtn:hover { background:#005cd0; }
    #message { text-align:center; color:#d9534f; margin-bottom:8px; }
    #map { width:90vw; max-width:900px; height:500px; margin:auto 0 40px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1); display:none; }
    footer { text-align:center; padding:2rem 1rem; background:#fff; font-size:0.9rem; color:#768ca3; border-top:1px solid #e1e8f0; }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">üå©Ô∏è StormBuddy</div>
    <div class="nav-links"><a href="index.html">Home</a></div>
  </nav>

  <form id="inputForm">
    <input type="text" id="locationInput" placeholder="Enter city or ZIP code" required/>
    <button type="submit" id="submitBtn">Show Radar</button>
  </form>
  <div id="message"></div>

  <div id="map"></div>

  <footer>&copy; 2025 StormBuddy, Inc. All rights reserved.</footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const form = document.getElementById('inputForm'),
          input = document.getElementById('locationInput'),
          message = document.getElementById('message'),
          mapDiv = document.getElementById('map');
    let map, radarLayer;

    form.addEventListener('submit', async e => {
      e.preventDefault();
      message.textContent = '';
      const q = input.value.trim();
      if (!q) return message.textContent = 'Please enter a location or ZIP code.';

      // 1. Geocode with Nominatim
      let geo;
      try {
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`);
        geo = await res.json();
      } catch {
        return message.textContent = 'Geocoding failed. Please try again.';
      }
      if (!geo.length) return message.textContent = 'Location not found.';

      const lat = parseFloat(geo[0].lat), lon = parseFloat(geo[0].lon);

      // 2. Create/update map
      mapDiv.style.display = 'block';
      if (!map) {
        map = L.map('map').setView([lat, lon], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
      } else {
        map.setView([lat, lon], 8);
        if (radarLayer) map.removeLayer(radarLayer);
      }

      // 3. Add real precipitation radar overlay
      const time = Math.floor(Date.now()/600000)*600; // nearest 10-min interval
      const appid = 'b9d33bea8d942f0252878002ea5e34b6';
      const urlTemplate = `https://maps.openweathermap.org/maps/2.0/radar/{z}/{x}/{y}?appid=${appid}&tm=${time}`;

      radarLayer = L.tileLayer(urlTemplate, { opacity: 0.5, tileSize: 256, zIndex: 5 })
                     .addTo(map);
    });
  </script>
</body>
</html>
